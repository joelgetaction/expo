{"version":3,"file":"apps.js","sourceRoot":"","sources":["../../src/utils/apps.ts"],"names":[],"mappings":"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","sourcesContent":["import { NativeModulesProxy } from '@unimodules/core';\n\nimport invariant from 'invariant';\nimport App from '../app';\nimport { DEFAULT_APP_NAME } from '../constants';\nimport { isObject, isString } from '.';\nimport { APP_STORE, CUSTOM_URL_OR_REGION_NAMESPACES } from './appStore';\nimport INTERNALS from './internals';\nimport parseConfig from './parseConfig';\nimport {\n  FirebaseModuleAndStatics,\n  FirebaseModuleName,\n  FirebaseModule,\n  FirebaseNamespace,\n  FirebaseOptions,\n} from '../types';\n\nconst { ExpoFirebaseApp: FirebaseCoreModule } = NativeModulesProxy;\n\nexport default {\n  app(name?: string): App {\n    const _name = name ? name.toUpperCase() : DEFAULT_APP_NAME;\n    const app = APP_STORE[_name];\n    invariant(app, INTERNALS.STRINGS.ERROR_APP_NOT_INIT(_name));\n    return app;\n  },\n\n  apps(): App[] {\n    // $FlowExpectedError: Object.values always returns mixed type: https://github.com/facebook/flow/issues/2221\n    return Object.values(APP_STORE);\n  },\n\n  async deleteApp(name: string): Promise<boolean> {\n    const app = APP_STORE[name];\n    if (!app) {\n      return true;\n    }\n\n    // https://firebase.google.com/docs/reference/js/firebase.app.App#delete\n\n    await app.delete();\n    delete APP_STORE[name];\n    return true;\n  },\n\n  /**\n   * Web SDK initializeApp\n   *\n   * @param options\n   * @param name\n   * @return {*}\n   */\n  initializeApp(options: FirebaseOptions | any, name: string): App {\n    invariant(!name || isString(name), INTERNALS.STRINGS.ERROR_INIT_STRING_NAME);\n\n    const _name = (name || DEFAULT_APP_NAME).toUpperCase();\n\n    const isDefault = _name === DEFAULT_APP_NAME;\n    // return an existing app if found\n    if (APP_STORE[_name] && !isDefault) {\n      return APP_STORE[_name];\n    }\n\n    // only validate if app doesn't already exist\n    // to allow apps already initialized natively\n    // to still go through init without erroring (backwards compatibility)\n    invariant(isObject(options), INTERNALS.STRINGS.ERROR_INIT_OBJECT);\n\n    options = parseConfig(options);\n\n    ['apiKey', 'appId', 'databaseURL', 'messagingSenderId', 'projectId', 'storageBucket'].forEach(\n      prop => {\n        invariant(options[prop], INTERNALS.STRINGS.ERROR_MISSING_OPT(prop));\n      }\n    );\n\n    APP_STORE[_name] = new App(_name, options);\n\n    return APP_STORE[_name];\n  },\n\n  /**\n   * Bootstraps all native app instances that were discovered on boot\n   */\n  initializeNativeApps(): void {\n    for (let i = 0, len = FirebaseCoreModule.apps.length; i < len; i++) {\n      const app = FirebaseCoreModule.apps[i];\n      const options = Object.assign({}, app);\n      delete options.name;\n      APP_STORE[app.name] = new App(app.name, options, true);\n    }\n  },\n  /**\n   *\n   * @param namespace\n   * @param statics\n   * @param moduleName\n   * @return {function(App=)}\n   */\n  moduleAndStatics<M, S>(\n    namespace: FirebaseNamespace,\n    statics: S,\n    moduleName: FirebaseModuleName\n  ): FirebaseModuleAndStatics<M, S> {\n    const getModule = (\n      appOrUrlOrRegion?: App | string,\n      customUrlOrRegion?: string\n    ): FirebaseModule => {\n      let _app: App | string | undefined | null = appOrUrlOrRegion;\n      let _customUrlOrRegion: string | null = customUrlOrRegion || null;\n\n      if (typeof appOrUrlOrRegion === 'string' && CUSTOM_URL_OR_REGION_NAMESPACES[namespace]) {\n        _app = null;\n        _customUrlOrRegion = appOrUrlOrRegion;\n      }\n\n      // throw an error if it's not a valid app instance\n      if (_app) {\n        invariant(_app instanceof App, INTERNALS.STRINGS.ERROR_NOT_APP(namespace));\n      } else {\n        // default to the 'DEFAULT' app if no arg provided - will throw an error\n        // if default app not initialized\n        _app = this.app(DEFAULT_APP_NAME);\n      }\n\n      // $FlowExpectedError: Flow doesn't support indexable signatures on classes: https://github.com/facebook/flow/issues/1323\n      const module = _app[namespace];\n      return module(_customUrlOrRegion);\n    };\n\n    return Object.assign(getModule, statics, {\n      nativeModuleExists: !!NativeModulesProxy[moduleName],\n    });\n  },\n};\n"]}